---
author: Nonclercq Basile
title: How protect your application with middleware ?
---

# Setup

1. Install Docker
2. Run docker pull bkimminich/juice-shop
3. Run docker run --rm -p 3000:3000 bkimminich/juice-shop
4. Browse to http://localhost:3000


#/score-board

Juice Shop Link: https://hub.docker.com/r/bkimminich/juice-shop

Schema for the next: 

* Vulnerability

    * Demonstration 
    * Fix

# SQL injection 

## Vulnerability Exploitation

![SQLi](./images/sqliVuln1.png)

![SQLi](./images/sqliVuln2.png)

<!-- ![SQLi](./images/sqliVuln3.png) -->

## Fix

> ```Need: WAF```

Choice: ModSecurity 

Works for Apache and Nginx

Prevent:

* SQL Injection
* Insuring the content type matches the body data.
* Protection against malformed POST requests.
* HTTP Protocol Protection
* Real-time Blacklist Lookups
* HTTP Denial of Service Protections
* Generic Web Attack Protection
* Error Detection and Hiding

Result: 



Repository : https://hub.docker.com/r/owasp/modsecurity-crs/

# XSS 

## Vulnerability Exploitation


Payload: 
```bash
<iframe src="javascript:alert(`Nice XSS`)">
```

![XSS](./images/XSSVuln1.png)

![XSS](./images/XSSVuln2.png)


## Fix

# Sensitive Data Exposure

## Vulnerability Exploitation

### Exploitation 1

In the reviews of many product, we can know email's users incuding the admin one : admin@juice-sh.op. He comments "I bought it, would buy again. 5/7" in the review of Eggfruit Juice (500ml).

Then, with bruteforcing or basic input (like admin123) we could enter in admin's account. This one could also fit with Broken Authentification.

### Exploitation 2

In the section "about us" we can see a link "Check out our boring terms of use if you are interested in such lame stuff" with the url: ip:port/ftp/legal.md

We can go to ftp directory and see a lot of file probably not for basic users. BUT we can't (for the moment) download all the files. When trying to download eastere.gg, we got the next error: 403 Error: Only .md and .pdf files are allowed!

![Sensitive Data Exposure](./images/SensitiveDataExposure1.png)


But if we add a null bytes "%00" then .md like that :

![Sensitive Data Exposure](./images/SensitiveDataExposure3.png)

(%25 stand for % in hexa) 

I's working. 

![Sensitive Data Exposure](./images/SensitiveDataExposure1.png)



## Fix


# Broken authentification

## Vulnerability Exploitation

Even if we could, from admin account, do malicious things, there're others ways. 

In the same way as we did before with admin's user, we find out jim@juice-sh.op who wrote: Fresh out of a replicator. From here, we can try to answer his security question in forgot password section. With some research, we reset his password and control the account.

![XSS](./images/brokenAuthVuln1.png)
![XSS](./images/brokenAuthVuln2.png)

## Fix